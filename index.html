<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Forms Management - Response Analysis</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-section {
            margin-bottom: 40px;
        }
        
        .form-section h2 {
            color: #1a73e8;
            border-bottom: 2px solid #1a73e8;
            padding-bottom: 10px;
        }
        
        .iframe-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        iframe {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .analysis-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .chart-placeholder {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            height: 400px;
            margin: 20px 0;
            padding: 20px;
        }
        
        .respondents-table {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .respondents-table table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        
        .respondents-table th,
        .respondents-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .respondents-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #1a73e8;
        }
        
        .respondents-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .respondents-table tr:last-child td {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #1a73e8;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #1a73e8;
        }
        
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .chart-container.full-width {
            grid-template-columns: 1fr;
        }
        
        .chart-container.three-column {
            grid-template-columns: 1fr 1fr 1fr;
        }
        
        .chart-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .controls {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .controls button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .controls button:hover {
            background-color: #1557b0;
        }
        
        .controls button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        @media print {
            .controls {
                display: none;
            }
            
            .form-section {
                display: none;
            }
            
            h1 {
                display: none;
            }
            
            .container {
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
            
            .chart-container {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 15px !important;
                page-break-inside: avoid;
                margin: 15px 0;
            }
            
            .chart-container.full-width {
                grid-template-columns: 1fr 1fr !important;
            }
            
            .chart-item {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 10px;
                height: 300px;
                border: 1px solid #ddd;
            }
            
            .chart-title {
                font-size: 14px !important;
                margin-bottom: 10px !important;
            }
            
            .section-title {
                page-break-after: avoid;
                margin-top: 20px;
                font-size: 18px;
            }
            
            .respondents-table {
                margin-bottom: 20px;
            }
            
            .respondents-table table {
                font-size: 12px;
            }
            
            .respondents-table th,
            .respondents-table td {
                padding: 6px 8px;
            }
            
            /* First chart container stays on page 1 with table */
            .chart-container:first-of-type {
                margin-top: 15px;
            }
            
            /* Second chart container starts page 2 */
            .chart-container:nth-of-type(2) {
                page-break-before: always;
                margin-top: 40px;
            }
            
            /* Third chart container continues on page 2 */
            .chart-container:nth-of-type(3) {
                margin-top: 15px;
            }
            
            /* Fourth chart container starts page 3 if needed */
            .chart-container:nth-of-type(4) {
                page-break-before: always;
                margin-top: 0;
            }
        }
        
        @media (max-width: 768px) {
            iframe {
                width: 100% !important;
                max-width: 640px;
            }
            
            .container {
                padding: 10px;
            }
            
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .chart-container.three-column {
                grid-template-columns: 1fr;
            }
            
            .chart-item {
                min-height: 300px;
            }
            
            .respondents-table {
                font-size: 14px;
            }
            
            .respondents-table th,
            .respondents-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Forms Management System</h1>
        
        <div class="form-section">
            <h2>üìù Form View</h2>
            <p>Below is the embedded Google Form. Users can fill out the form directly from this page.</p>
            
            <div class="iframe-container">
                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSejWVX-ffWtWgEuGCDh0BCsbXO93lhZA17Pz_o1JUgbjyAUeQ/viewform?embedded=true" 
                        width="640" 
                        height="2541" 
                        frameborder="0" 
                        marginheight="0" 
                        marginwidth="0">
                    Loading‚Ä¶
                </iframe>
            </div>
        </div>
        
        <div class="analysis-section">
            <h2>üìä Response Analysis</h2>
            <p>Real-time analysis of peer pressure survey responses with interactive charts powered by Google Charts.</p>
            
            <div class="controls">
                <button onclick="loadPeerPressureData()">Load Peer Pressure Survey Data</button>
                <button onclick="refreshCharts()">Refresh Charts</button>
                <button onclick="printAnalysis()" disabled>Print Report</button>
                <button onclick="exportData()" disabled>Export Data</button>
            </div>
            
            <!-- Respondents Table -->
            <div class="section-title">üë• Survey Respondents</div>
            <div class="respondents-table">
                <table id="respondentsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Grade</th>
                            <th>School</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" style="text-align: center; color: #666;">
                                Click "Load Peer Pressure Survey Data" to view respondents
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Charts Section -->
            <div class="section-title">üìà Survey Question Analysis</div>
            
            <!-- Grade Distribution -->
            <div class="chart-container">
                <div class="chart-item">
                    <div class="chart-title">Grade Distribution of Respondents</div>
                    <div id="gradeChart" class="chart-placeholder"></div>
                </div>
                
                <div class="chart-item">
                    <div class="chart-title">Q1: Why does peer pressure happen?</div>
                    <div id="q1Chart" class="chart-placeholder"></div>
                </div>
            </div>
            
            <!-- Question 2 & 3 -->
            <div class="chart-container">
                <div class="chart-item">
                    <div class="chart-title">Q2: Does peer pressure happen in your class?</div>
                    <div id="q2Chart" class="chart-placeholder"></div>
                </div>
                
                <div class="chart-item">
                    <div class="chart-title">Q3: Does peer pressure affect you?</div>
                    <div id="q3Chart" class="chart-placeholder"></div>
                </div>
            </div>
            
            <!-- Question 4 & 5 -->
            <div class="chart-container">
                <div class="chart-item">
                    <div class="chart-title">Q4: How does it affect you?</div>
                    <div id="q4Chart" class="chart-placeholder"></div>
                </div>
                
                <div class="chart-item">
                    <div class="chart-title">Q5: Does it affect teachers and parents?</div>
                    <div id="q5Chart" class="chart-placeholder"></div>
                </div>
            </div>
            
            <!-- Question 6 -->
            <div class="chart-container">
                <div class="chart-item">
                    <div class="chart-title">Q6: Who taught you about peer pressure?</div>
                    <div id="q6Chart" class="chart-placeholder"></div>
                </div>
                
                <div class="chart-item" style="visibility: hidden;">
                    <!-- Empty space to maintain 2x2 grid -->
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Load Google Charts
        google.charts.load('current', {'packages':['corechart', 'bar', 'line']});
        google.charts.setOnLoadCallback(initializeCharts);

        // Real Peer Pressure Survey Data
        const peerPressureData = {
            respondents: [
                ['Name', 'Grade', 'School'],
                ['Bala', 'Grade 5', 'Velamaal'],
                ['Karthik', 'Grade 5', 'St. John\'s School'],
                ['Sarah', 'Grade 4', 'Emerald Valley Public School'],
                ['Sundar Ramakrishnan', 'Grade 3', 'Sri Seshaas International Public School'],
                ['Ananya R', 'Grade 5', 'Oakridge International School'],
                ['Arjun A', 'Grade 3', 'Velammal Vidyalaya'],
                ['Suresh Kumar M', 'Grade 4', 'Narayana e-Techno School']
            ],
            gradeDistribution: [
                ['Grade', 'Count'],
                ['Grade 3', 2],
                ['Grade 4', 2], 
                ['Grade 5', 3]
            ],
            question1_whyPeerPressure: [
                ['Response', 'Count'],
                ['All of the above', 6],
                ['Some kids think everyone should do the same things they do', 1]
            ],
            question2_pressureInClass: [
                ['Frequency', 'Count'],
                ['Yes, all the time', 2],
                ['Sometimes', 4],
                ['Rarely', 1]
            ],
            question3_pressureAffectsYou: [
                ['Level', 'Count'],
                ['Yes, a lot', 3],
                ['Sometimes', 4]
            ],
            question4_howItAffects: [
                ['Response', 'Count'],
                ['I try harder to fit in', 3],
                ['I feel nervous or worried', 2],
                ['I talk to someone about it', 1],
                ['I do things I don\'t want to do', 1]
            ],
            question5_affectsTeachersParents: [
                ['Response', 'Count'],
                ['Yes, both teachers and parents', 2],
                ['Only teachers', 1],
                ['No, it doesn\'t affect them', 4]
            ],
            question6_whoTaughtWord: [
                ['Source', 'Count'],
                ['My teacher', 4],
                ['I learned it myself (Google or other sources)', 2],
                ['My parents', 1]
            ],
            responseTimeline: [
                ['Date', 'Responses'],
                ['Aug 30', 4],
                ['Aug 31', 3]
            ]
        };

        function initializeCharts() {
            console.log('Google Charts loaded successfully');
            drawPlaceholderMessage();
        }

        function drawPlaceholderMessage() {
            ['gradeChart', 'q1Chart', 'q2Chart', 'q3Chart', 'q4Chart', 'q5Chart', 'q6Chart'].forEach(chartId => {
                document.getElementById(chartId).innerHTML = 
                    '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 16px;">' +
                    '<div>üìä Click "Load Peer Pressure Survey Data" to view charts</div></div>';
            });
        }

        function loadPeerPressureData() {
            loadRespondentsTable();
            drawGradeDistribution();
            drawQuestion1Chart();
            drawQuestion2Chart();
            drawQuestion3Chart();
            drawQuestion4Chart();
            drawQuestion5Chart();
            drawQuestion6Chart();
            
            // Enable export and print buttons
            document.querySelector('button[onclick="exportData()"]').disabled = false;
            document.querySelector('button[onclick="printAnalysis()"]').disabled = false;
        }

        function loadRespondentsTable() {
            const tableBody = document.querySelector('#respondentsTable tbody');
            tableBody.innerHTML = '';
            
            // Skip header row and add each respondent
            for (let i = 1; i < peerPressureData.respondents.length; i++) {
                const respondent = peerPressureData.respondents[i];
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = respondent[0]; // Name
                row.insertCell(1).textContent = respondent[1]; // Grade
                row.insertCell(2).textContent = respondent[2]; // School
            }
        }

        function loadSampleData() {
            // Keep the old function for backwards compatibility
            loadPeerPressureData();
        }

        function drawGradeDistribution() {
            const data = google.visualization.arrayToDataTable(peerPressureData.gradeDistribution);

            const options = {
                title: 'Survey Responses by Grade Level',
                titleTextStyle: {
                    fontSize: 16,
                    bold: true
                },
                pieHole: 0.3,
                colors: ['#4285f4', '#34a853', '#fbbc05'],
                legend: {
                    position: 'bottom',
                    alignment: 'center'
                },
                chartArea: {
                    left: 10,
                    top: 50,
                    width: '100%',
                    height: '70%'
                }
            };

            const chart = new google.visualization.PieChart(document.getElementById('gradeChart'));
            chart.draw(data, options);
        }

        function drawQuestion1Chart() {
            const data = google.visualization.arrayToDataTable(peerPressureData.question1_whyPeerPressure);

            const options = {
                title: 'Why does peer pressure happen?',
                titleTextStyle: {
                    fontSize: 14,
                    bold: true
                },
                pieHole: 0.4,
                colors: ['#1a73e8', '#ff9800'],
                legend: {
                    position: 'bottom',
                    alignment: 'center'
                },
                chartArea: {
                    left: 10,
                    top: 50,
                    width: '100%',
                    height: '60%'
                }
            };

            const chart = new google.visualization.PieChart(document.getElementById('q1Chart'));
            chart.draw(data, options);
        }

        function drawQuestion2Chart() {
            const data = google.visualization.arrayToDataTable(peerPressureData.question2_pressureInClass);

            const options = {
                title: 'Frequency in Class',
                titleTextStyle: {
                    fontSize: 14,
                    bold: true
                },
                colors: ['#34a853'],
                hAxis: {
                    title: 'Frequency'
                },
                vAxis: {
                    title: 'Count'
                },
                legend: { position: 'none' },
                chartArea: {
                    left: 50,
                    top: 50,
                    width: '80%',
                    height: '60%'
                }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('q2Chart'));
            chart.draw(data, options);
        }

        function drawQuestion3Chart() {
            const data = google.visualization.arrayToDataTable(peerPressureData.question3_pressureAffectsYou);

            const options = {
                title: 'Does it affect you?',
                titleTextStyle: {
                    fontSize: 14,
                    bold: true
                },
                pieHole: 0.4,
                colors: ['#ff5722', '#2196f3'],
                legend: {
                    position: 'bottom',
                    alignment: 'center'
                },
                chartArea: {
                    left: 10,
                    top: 50,
                    width: '100%',
                    height: '60%'
                }
            };

            const chart = new google.visualization.PieChart(document.getElementById('q3Chart'));
            chart.draw(data, options);
        }

        function drawQuestion4Chart() {
            const data = google.visualization.arrayToDataTable(peerPressureData.question4_howItAffects);

            const options = {
                title: 'How does it affect you?',
                titleTextStyle: {
                    fontSize: 14,
                    bold: true
                },
                colors: ['#ff9800'],
                hAxis: {
                    title: 'Count'
                },
                vAxis: {
                    title: 'Response'
                },
                legend: { position: 'none' },
                chartArea: {
                    left: 150,
                    top: 50,
                    width: '60%',
                    height: '60%'
                }
            };

            const chart = new google.visualization.BarChart(document.getElementById('q4Chart'));
            chart.draw(data, options);
        }

        function drawQuestion5Chart() {
            const data = google.visualization.arrayToDataTable(peerPressureData.question5_affectsTeachersParents);

            const options = {
                title: 'Does it affect teachers and parents?',
                titleTextStyle: {
                    fontSize: 14,
                    bold: true
                },
                colors: ['#9c27b0'],
                hAxis: {
                    title: 'Response'
                },
                vAxis: {
                    title: 'Count'
                },
                legend: { position: 'none' },
                chartArea: {
                    left: 50,
                    top: 50,
                    width: '80%',
                    height: '60%'
                }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('q5Chart'));
            chart.draw(data, options);
        }

        function drawQuestion6Chart() {
            const data = google.visualization.arrayToDataTable(peerPressureData.question6_whoTaughtWord);

            const options = {
                title: 'Who taught you about peer pressure?',
                titleTextStyle: {
                    fontSize: 14,
                    bold: true
                },
                pieHole: 0.4,
                colors: ['#4caf50', '#2196f3', '#ff5722'],
                legend: {
                    position: 'bottom',
                    alignment: 'center'
                },
                chartArea: {
                    left: 10,
                    top: 50,
                    width: '100%',
                    height: '60%'
                }
            };

            const chart = new google.visualization.PieChart(document.getElementById('q6Chart'));
            chart.draw(data, options);
        }

        function refreshCharts() {
            if (document.querySelector('button[onclick="exportData()"]').disabled) {
                alert('Please load peer pressure survey data first');
                return;
            }
            
            // Refresh with peer pressure data
            loadPeerPressureData();
            console.log('Peer pressure survey charts refreshed');
        }

        function printAnalysis() {
            if (document.querySelector('button[onclick="printAnalysis()"]').disabled) {
                alert('Please load peer pressure survey data first');
                return;
            }
            
            // Add print title
            const originalTitle = document.title;
            document.title = 'Peer Pressure Survey Analysis Report';
            
            // Print the page
            window.print();
            
            // Restore original title
            document.title = originalTitle;
        }

        function exportData() {
            // Export peer pressure survey data
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Grade,Count\n" +
                peerPressureData.gradeDistribution.slice(1).map(row => row.join(",")).join("\n") +
                "\n\nPeer Pressure in Class,Count\n" +
                peerPressureData.pressureInClass.slice(1).map(row => row.join(",")).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "peer_pressure_survey_analysis.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            if (!document.querySelector('button[onclick="exportData()"]').disabled) {
                setTimeout(loadPeerPressureData, 100);
            }
        });

        // Function to integrate with real Google Forms API
        async function fetchRealFormData(formId) {
            try {
                // This would be your actual API call to Google Forms
                // const response = await fetch(`/api/forms/${formId}/responses`);
                // const data = await response.json();
                // return processResponseData(data);
                
                console.log('This function will fetch real data from Google Forms API');
                return peerPressureData; // For now, return peer pressure data
            } catch (error) {
                console.error('Error fetching form data:', error);
                return null;
            }
        }

        function processResponseData(rawData) {
            // Process the raw Google Forms response data
            // Convert it to the format needed for charts
            // This function processes your actual CSV data from "Responses of Peer Pressure Survey - Form Responses.csv"
            console.log('Processing peer pressure survey data...');
            return peerPressureData;
        }
    </script>
</body>
</html>
